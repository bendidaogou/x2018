<link rel="stylesheet" type="text/css" href="/libs/zTree/css/zTreeStyle/zTreeStyle.css">
<script src="/libs/zTree/js/jquery.ztree.core.js"></script>

<!--<div class="panel-body">-->
    <!--<div class="panel panel-default">-->
        <!--<div class="panel-heading">查询条件</div>-->
        <!--<div class="panel-body" style="padding-bottom: 0px;">-->
            <!--<form id="form" class="form-horizontal">-->
                <!--<div class="form-group">-->
                    <!--<div class="col-sm-4" style="padding-top: 2px;">-->
                        <!--<input type="text" class="form-control" name="resourcesName" placeholder="资源名">-->
                    <!--</div>-->
                    <!--<div class="col-sm-4" style="padding-top: 2px;">-->
                        <!--<input type="text" class="form-control" name="resourcesName" placeholder="资源名">-->
                    <!--</div>-->
                    <!--<div class="col-sm-4" style="padding-top: 2px;">-->
                        <!--<input type="text" class="form-control" name="resourcesName" placeholder="资源名">-->
                    <!--</div>-->
                <!--</div>-->
            <!--</form>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->

<div class="col-sm-3">
    <style type="text/css">
        .ztree li * {
            font-size: 14px;
            margin: 5px;
        }
    </style>

    <ul id="zTree" class="ztree"></ul>
</div>

<div class="col-sm-9">
    <div id="toolbar">

        <button id="btnPlus" class="btn btn-default" onclick="add()">
            <span class="glyphicon glyphicon-plus" aria-hidden="true">新增</span>
        </button>
        <button id="btnPencil" class="btn btn-default">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true">修改</span>
        </button>
        <button id="btnRemove" class="btn btn-default">
            <span class="glyphicon glyphicon-remove" aria-hidden="true">删除</span>
        </button>
    </div>
    <table id="table"></table>
</div>

<script>

    var setting = {
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
            onClick: zTreeOnClick
        }
    };

    $(function () {
        $.get('/sys/resources/menu/list', {}, function (rev) {
            var zNodes = [];
            $.each(rev.rows, function (i, v) {
                zNodes.push({id: v.resourcesId, pId: v.resourcesPid, name: v.resourcesName, type: v.resourcesType})
            });
            $.fn.zTree.init($("#zTree"), setting, zNodes).expandAll(true);

            initTable("-1");

        }, 'json');
    });

    //zTree点击事件
    function zTreeOnClick(event, treeId, treeNode) {
        if (0 == treeNode.type) {
            initTable(treeNode.id);
        } else {
            $('#table').bootstrapTable('uncheckAll').bootstrapTable("removeAll");
            console.log('----所选非菜单……')
        }
    }

    //初始化表格
    function initTable(menuId) {
        $('#table').bootstrapTable('destroy')
            .bootstrapTable({
                url: '/sys/resources/perm/list?menuId=' + menuId,
                method: 'get',
                toolbar: '#toolbar',
                striped: true,
                cache: false,
                pagination: false,
                queryParams: queryParams,
                sidePagination: "server",
                // pageNumber: 1,
                // pageSize: 10,
                // pageList: [10, 20, 50, 100],
                showColumns: true,
                showRefresh: true,
                clickToSelect: true,
                idField: 'resourcesId',
                selectItemName: 'btSelectItem',
                columns: [
                    {
                        radio: true,
                    }, {
                        field: 'resourcesName',
                        title: '权限'
                    }, {
                        field: 'resourcesCode',
                        title: 'CODE'
                    }, {
                        field: 'resourcesStatusName',
                        title: '状态'
                    }
                ],
                onClickRow: function (item, $element) {
                    return false;
                }
            });
    }

    //查询条件
    function queryParams(params) {
        return $.extend({}, {
            offset: params.offset, //分页起始偏移
            limit: params.limit //分页条数
        }, $('#form').getFormValues()); //form表单
    }

    function add() {
        var radioName = $('#table').bootstrapTable('getOptions').selectItemName;
        var radioVal = $('input:radio[name="' + radioName + '"]:checked').val();
        if (!radioVal) {
            return;
        }
        console.log(radioVal);
    }

</script>
